<div class="ownevents-container hc-page">
  <div class="page-header">
    <h1 class="page-title">Saj√°t Esem√©nyek</h1>
    <div class="header-actions">
      <a class="link-btn" routerLink="/events">√ñsszes esem√©ny</a>
      @if (!showForm) {
        <button class="primary-btn create-btn" type="button" (click)="startCreate()">
          √öj esem√©ny hozz√°ad√°sa
        </button>
      }
    </div>
  </div>

  @if (showForm) {
    <section class="form-wrapper">
      <div class="form-header">
        <h2>√öj esem√©ny l√©trehoz√°sa</h2>
        <button class="ghost-btn" type="button" (click)="cancelForm()">M√©gse</button>
      </div>
      <div class="form-error">{{ formError }}</div>
      <form class="event-form" [formGroup]="eventForm" (ngSubmit)="submitForm()">
        <div class="form-grid">
          <label>
            C√≠m
            <input formControlName="title" />
          </label>
          <label>
            D√°tum √©s Id≈ë
            <input type="datetime-local" formControlName="date" />
          </label>
          <label>
            Helysz√≠n
            <input formControlName="location" />
          </label>
          <label>
            Kapacit√°s
            <input type="number" formControlName="capacity" />
            <span *ngIf="eventForm.get('capacity')?.invalid && eventForm.get('capacity')?.touched" class="input-error">Sz√ºks√©ges √©s 1-n√©l nagyobbnak kell lennie</span>
          </label>
          <label>
            St√°tusz
            <select formControlName="status">
              <option value="Akt√≠v">Akt√≠v</option>
              <option value="Inakt√≠v">Inakt√≠v</option>
            </select>
          </label>
        </div>
        <label class="full-width">
          Le√≠r√°s
          <textarea class="about-edit-textarea about-edit-textarea--large" formControlName="description" rows="12"></textarea>
        </label>
        <div class="form-actions">
          <button class="primary-btn" type="submit" [disabled]="submitting">
            Esem√©ny l√©trehoz√°sa
          </button>
          <button class="ghost-btn" type="button" (click)="clearFormFields()">≈∞rlap t√∂rl√©se</button>
        </div>
      </form>
    </section>
  }
 
  <div class="dropdown-wrapper" (click)="$event.stopPropagation()">
    <button class="dropdown-toggle" (click)="toggleDropdown()" [class.open]="isDropdownOpen">
      <span class="dropdown-text">{{ selectedOrganization?.organization_name || 'Szervezet kiv√°laszt√°sa' }}</span>
      <span class="dropdown-arrow">{{ isDropdownOpen ? '‚ñ≤' : '‚ñº' }}</span>
    </button>
    
    @if (isDropdownOpen) {
      <div class="dropdown-menu">
        @for (org of organizationEvents; track org.organization_id) {
          <button 
            class="dropdown-item" 
            [class.active]="selectedOrganization?.organization_id === org.organization_id"
            (click)="selectOrganization(org)"
          >
            <span class="org-name">{{ org.organization_name }}</span>
            <span class="event-count">({{ org.events?.length || 0 }} esem√©ny)</span>
          </button>
        }
      </div>
    }
  </div>

 
  @if (selectedOrganization) {
    <div class="search-container">
      <input 
        type="text" 
        class="search-input" 
        placeholder="Esem√©ny keres√©se..."
        [value]="searchTerm"
        (input)="searchTerm = $any($event.target).value; onSearchChange()"
      />
      <span class="search-icon">üîç</span>
    </div>

    
    <div class="events-section">
      <h2 class="org-title">{{ selectedOrganization.organization_name }}</h2>
      
      <div class="cards-grid">
        @if (filteredEvents && filteredEvents.length > 0) {
          @for (event of filteredEvents; track event.id) {
            <div class="event-card">
              <div class="card-media">
                <img
                  [src]="categoryImageFor(selectedOrganization.organization_category)"
                  [alt]="selectedOrganization.organization_category || selectedOrganization.organization_name"
                />
              </div>
              <div class="card-header">
                <a class="card-main" [routerLink]="['/aboutevent', event.id]" [queryParams]="{ own: 1 }">
                  <div class="card-info-summary">
                    <h3 class="card-title">{{ event.title || 'Esem√©ny' }}</h3>
                    @if (event.date) {
                      <p class="card-date">{{ event.date | date:'yyyy.MM.dd.' }}</p>
                    }
                  </div>
                </a>
              </div>
            </div>
          }
        } @else {
          <div class="no-events">
            <p>{{ searchTerm ? 'Nincs olyan esem√©ny, amely megfelel a keres√©si felt√©teleknek.' : 'Nincs esem√©ny enn√©l a szervezetn√©l.' }}</p>
          </div>
        }
      </div>
    </div>
  }

  @if (!organizationEvents || organizationEvents.length === 0) {
    <div class="empty-state">
      <p>Nincs megjelen√≠thet≈ë szervezet.</p>
    </div>
  }
</div>
