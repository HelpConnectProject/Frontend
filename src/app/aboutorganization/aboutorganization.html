
@if (!loading && org) {
	<div class="about-org-modern">
		<nav class="about-org-nav">
			@if (isOwnView) {
				<a routerLink="/ownorganizations" class="back-btn">Vissza a saját szervezetekhez</a>
			} @else {
				<a (click)="reset()" routerLink="/organizations" class="back-btn">Vissza a szervezetekhez</a>
			}
		</nav>
		<section class="about-org-main">
			<div class="about-org-logo-modern">
				@if (org.logo) {
					<img [src]="org.logo" [alt]="org.name" />
				} @else {
					<img [src]="categoryImageFor(org.category)" [alt]="org.category || org.name" />
				}
			</div>
			<div class="about-org-info-modern">
				<div class="about-org-header-row">
					<div>
						@if (!editMode) {
							<h1 class="about-org-title-modern">{{ org.name }}</h1>
							@if (org.category) {
								<span class="about-org-category-modern">{{ org.category }}</span>
							}
	                        
						} @else {
								<input class="about-edit-input title" type="text" [formControl]="$any(orgForm.get('name'))" placeholder="Név" />
								@if (orgForm.get('name')?.touched && orgForm.get('name')?.hasError('required')) {
									<div class="input-error">A név megadása kötelező.</div>
								}
							<select class="about-edit-input category" [formControl]="$any(orgForm.get('category'))">
								<option value="">Válassz kategóriát…</option>
								<option>Szociális és humanitárius szervezetek</option>
								<option>Egészségügyi szervezetek</option>
								<option>Oktatási és tudományos szervezetek</option>
								<option>Környezetvédelmi szervezetek</option>
								<option>Emberi jogi és jogvédő szervezetek</option>
								<option>Kulturális és művészeti szervezetek</option>
								<option>Sport és szabadidős szervezetek</option>
								<option>Ifjúsági és közösségfejlesztő szervezetek</option>
								<option>Érdekvédelmi és szakmai szervezetek</option>
							</select>
						}
					</div>
					@if (isOwnView) {
						<div class="about-org-actions">
							@if (!editMode) {
								<button type="button" class="action-btn edit" (click)="startEdit()">Szerkesztés</button>
							} @else {
								<button type="button" class="action-btn edit" (click)="saveOrganization()" [disabled]="saving">Mentés</button>
								<button type="button" class="action-btn" (click)="cancelEdit()" [disabled]="saving">Mégse</button>
							}
							@if (!showAddManager) {
								<button type="button" class="action-btn success" (click)="openAddManager()" [disabled]="saving">Manager hozzáadása</button>
							}
							<button type="button" class="action-btn delete" (click)="deleteOrganization()" [disabled]="saving">Törlés</button>
						</div>
					}
				</div>
			</div>
								<div class="about-org-details-modern">
								@if (isOwnView && showAddManager) {
									<div class="about-org-detail-row">
										<span class="detail-label">Új manager:</span>
										<span class="detail-value">
											<div class="manager-inline">
												<input
													class="about-edit-input"
													type="email"
													placeholder="Email cím"
													[formControl]="$any(managerForm.get('email'))"
												/>
												<button type="button" class="action-btn success" (click)="addManagerByEmail()" [disabled]="addingManager">
													Hozzáadás
												</button>
												<button type="button" class="action-btn" (click)="cancelAddManager()" [disabled]="addingManager">
													Mégse
												</button>
											</div>
											@if (managerForm.get('email')?.touched && managerForm.get('email')?.invalid) {
												<div class="input-error">Adj meg egy érvényes email címet.</div>
											}
										</span>
									</div>
								}
								@if (editMode && editError) {
										<div class="about-edit-error">{{ editError }}</div>
								}
								<div class="about-org-detail-row">
										<span class="detail-label">Email:</span>
										<span class="detail-value">
												@if (!editMode) {
														{{ org.email }}
												} @else {
																<input class="about-edit-input" type="email" [formControl]="$any(orgForm.get('email'))" placeholder="Email" />
																@if (orgForm.get('email')?.touched && orgForm.get('email')?.hasError('email')) {
																	<div class="input-error">Adj meg egy érvényes email címet.</div>
																}
												}
										</span>
								</div>
				@if (editMode || org.description) {
					<div class="about-org-detail-row">
						<span class="detail-label">Leírás:</span>
						<span class="detail-value">
							@if (!editMode) {
								{{ org.description }}
							} @else {
									<textarea class="about-edit-textarea about-edit-textarea--large" rows="12" [formControl]="$any(orgForm.get('description'))" placeholder="Leírás"></textarea>
							}
						</span>
					</div>
				}
				@if (editMode || org.phone) {
					<div class="about-org-detail-row">
						<span class="detail-label">Telefonszám:</span>
						<span class="detail-value">
							@if (!editMode) {
								{{ org.phone }}
							} @else {
								<input class="about-edit-input" type="tel" [formControl]="$any(orgForm.get('phone'))" placeholder="Telefonszám" />
								@if (orgForm.get('phone')?.touched && orgForm.get('phone')?.hasError('phoneInvalidChars')) {
									<div class="input-error">Csak számok, szóköz, +, -, () karakterek engedélyezettek.</div>
								} @else if (orgForm.get('phone')?.touched && orgForm.get('phone')?.hasError('phoneDigits')) {
									<div class="input-error">A telefonszám hossza 9–15 számjegy legyen.</div>
								}
							}
						</span>
					</div>
				}
				@if (editMode || org.address) {
					<div class="about-org-detail-row">
						<span class="detail-label">Cím:</span>
						<span class="detail-value">
							@if (!editMode) {
								{{ org.address }}
							} @else {
								<input class="about-edit-input" type="text" [formControl]="$any(orgForm.get('address'))" placeholder="Cím" />
							}
						</span>
					</div>
				}
				@if (editMode || org.bank_account) {
					<div class="about-org-detail-row">
						<span class="detail-label">Bankszámla:</span>
						<span class="detail-value bank-account-modern">
							@if (!editMode) {
								{{ org.bank_account }}
							} @else {
								<input class="about-edit-input" type="text" [formControl]="$any(orgForm.get('bank_account'))" placeholder="Bankszámla" />
								@if (orgForm.get('bank_account')?.touched && orgForm.get('bank_account')?.hasError('bankAccount')) {
									<div class="input-error">Adj meg érvényes bankszámlaszámot (pl. HU + 26 számjegy, vagy 8-8(-8) formátum).</div>
								}
							}
						</span>
					</div>
				}
				@if (editMode || org.website) {
					<div class="about-org-detail-row">
						<span class="detail-label">Weboldal:</span>
						<span class="detail-value">
							@if (!editMode) {
								<a [href]="org.website" target="_blank" rel="noopener noreferrer">{{ org.website }}</a>
							} @else {
								<input class="about-edit-input" type="text" [formControl]="$any(orgForm.get('website'))" placeholder="Weboldal" />
								@if (orgForm.get('website')?.touched && orgForm.get('website')?.hasError('pattern')) {
									<div class="input-error">Adj meg érvényes weboldal címet (pl. https://pelda.hu).</div>
								}
							}
						</span>
					</div>
				}

				@if (managerError) {
					<div class="about-edit-error">{{ managerError }}</div>
				}
				@if (managerSuccess) {
					<div class="hc-success">{{ managerSuccess }}</div>
				}

				@if (isOwnView) {
				  <div class="about-org-detail-row">
					  <span class="detail-label">Adminok:</span>
					  <span class="detail-value">
						  @if (membersLoading) {
							  <span class="detail-muted">Betöltés...</span>
						  } @else if (membersError) {
							  <span class="about-edit-error">{{ membersError }}</span>
						  } @else if (members && members.length > 0) {
							  <div class="manager-list">
								  @for (m of members; track $index) {
									  <span class="manager-chip">{{ memberDisplay(m) }}</span>
								  }
							  </div>
						  } @else {
							  <span class="detail-muted">Nincs még admin.</span>
						  }
					  </span>
				  </div>
				}



				<button type="button" class="feedback-submit-btn" (click)="searchEventsForOrg()">Események keresése ennél a szervezetnél</button>




				<section class="past-events-section">
					<h2 class="past-events-title">Múltbéli események</h2>
					@if (events && events.length > 0) {
						<div class="past-events-list">
							@for(event of events; track event.id) {
								<article class="event-feedback-block">
									<div class="event-card-header">
										<div class="event-card-title">{{ event.title }}</div>
										<div class="event-card-meta">{{ event.date | date:'yyyy.MM.dd. HH:mm' }}</div>
									</div>
							@if(event.feedbacks && event.feedbacks.length > 0) {
								<div class="event-feedback-list">
									<b>Visszajelzések:</b><br>
									@for(feedback of event.feedbacks; track feedback.id) {
										<div class="feedback-item">
											<div class="feedback-left">
												<div class="feedback-text" style="display: flex; align-items: center; gap: 12px;">
													<span class="feedback-comment">{{feedback.comment}}</span>
													@if (feedback.updated_at) {
														<span class="feedback-date" style="margin-left: 8px; color: #888; font-size: 0.95em; white-space: nowrap;">{{ feedback.updated_at | date:'yyyy.MM.dd. HH:mm' }}</span>
													}
												</div>
												<span class="star-rating-static feedback-stars">
													@for(star of getStars(5); track star) {
														<span class="star" [class.filled]="star <= feedback.rating">&#9733;</span>
													}
												</span>
											</div>
											@if (canDeleteFeedback(feedback)) {
												<div class="feedback-right">
													<button type="button" class="action-btn delete" (click)="deleteFeedback(feedback.id)">Törlés</button>
												</div>
											}
										</div>
									}
								</div>
							} @else {
								<span>Nincs visszajelzés.</span><br>
							}
							@if (authService.isLoggedIn$ | async) {
								<form (submit)="addFeedback(event.id, $event)" class="event-feedback-form">
									<input type="text" name="comment" placeholder="Komment" required class="feedback-input">
									<span class="star-rating">
										@for(star of [5,4,3,2,1]; track star) {
											<input type="radio" id="star-{{event.id}}-{{star}}" name="rating" value="{{star}}" required>
											<label for="star-{{event.id}}-{{star}}" class="star">&#9733;</label>
										}
									</span>
									<button type="submit" class="feedback-submit-btn">Visszajelzés küldése</button>
								</form>
							}
							</article>
							}
						</div>
					} @else {
						<p class="past-events-empty">Nincs még múltbeli esemény.</p>
					}
				</section>
			</div>
		</section>
	</div>
}
@if (!loading && !org) {
	<div class="about-org-notfound">
		<p>A szervezet nem található.</p>
	</div>
}
@if (loading) {
	<div class="about-org-loading">
		<p>Betöltés...</p>
	</div>
}
