
@if (!loading && org) {
	<div class="about-org-modern">
		<nav class="about-org-nav">
			@if (isOwnView) {
				<a routerLink="/ownorganizations" class="back-btn">Vissza a saját szervezetekhez</a>
			} @else {
				<a (click)="reset()" routerLink="/organizations" class="back-btn">Vissza a szervezetekhez</a>
			}
		</nav>
		<section class="about-org-main">
			<div class="about-org-logo-modern">
				@if (org.logo) {
					<img [src]="org.logo" [alt]="org.name" />
				} @else {
					<span class="logo-placeholder-modern">{{ org.name.substring(0, 2).toUpperCase() }}</span>
				}
			</div>
			<div class="about-org-info-modern">
				<div class="about-org-header-row">
					<div>
						@if (!editMode) {
							<h1 class="about-org-title-modern">{{ org.name }}</h1>
							@if (org.category) {
								<span class="about-org-category-modern">{{ org.category }}</span>
							}
						} @else {
							<input class="about-edit-input title" type="text" [formControl]="$any(orgForm.get('name'))" placeholder="Név" />
							<input class="about-edit-input category" type="text" [formControl]="$any(orgForm.get('category'))" placeholder="Kategória" />
						}
					</div>
					@if (isOwnView) {
						<div class="about-org-actions">
							@if (!editMode) {
								<button type="button" class="action-btn edit" (click)="startEdit()">Szerkesztés</button>
							} @else {
								<button type="button" class="action-btn edit" (click)="saveOrganization()" [disabled]="saving">Mentés</button>
								<button type="button" class="action-btn" (click)="cancelEdit()" [disabled]="saving">Mégse</button>
							}
							<button type="button" class="action-btn delete" (click)="deleteOrganization()" [disabled]="saving">Törlés</button>
						</div>
					}
				</div>
			</div>
			<div class="about-org-details-modern">
				@if (editMode && editError) {
					<div class="about-edit-error">{{ editError }}</div>
				}
				<div class="about-org-detail-row">
					<span class="detail-label">Email:</span>
					<span class="detail-value">
						@if (!editMode) {
							{{ org.email }}
						} @else {
							<input class="about-edit-input" type="email" [formControl]="$any(orgForm.get('email'))" placeholder="Email" />
						}
					</span>
				</div>
				@if (editMode || org.description) {
					<div class="about-org-detail-row">
						<span class="detail-label">Leírás:</span>
						<span class="detail-value">
							@if (!editMode) {
								{{ org.description }}
							} @else {
								<textarea class="about-edit-textarea" rows="3" [formControl]="$any(orgForm.get('description'))" placeholder="Leírás"></textarea>
							}
						</span>
					</div>
				}
				@if (editMode || org.phone) {
					<div class="about-org-detail-row">
						<span class="detail-label">Telefonszám:</span>
						<span class="detail-value">
							@if (!editMode) {
								{{ org.phone }}
							} @else {
								<input class="about-edit-input" type="tel" [formControl]="$any(orgForm.get('phone'))" placeholder="Telefonszám" />
							}
						</span>
					</div>
				}
				@if (editMode || org.address) {
					<div class="about-org-detail-row">
						<span class="detail-label">Cím:</span>
						<span class="detail-value">
							@if (!editMode) {
								{{ org.address }}
							} @else {
								<input class="about-edit-input" type="text" [formControl]="$any(orgForm.get('address'))" placeholder="Cím" />
							}
						</span>
					</div>
				}
				@if (editMode || org.bank_account) {
					<div class="about-org-detail-row">
						<span class="detail-label">Bankszámla:</span>
						<span class="detail-value bank-account-modern">
							@if (!editMode) {
								{{ org.bank_account }}
							} @else {
								<input class="about-edit-input" type="text" [formControl]="$any(orgForm.get('bank_account'))" placeholder="Bankszámla" />
							}
						</span>
					</div>
				}
				@if (editMode || org.website) {
					<div class="about-org-detail-row">
						<span class="detail-label">Weboldal:</span>
						<span class="detail-value">
							@if (!editMode) {
								<a [href]="org.website" target="_blank" rel="noopener noreferrer">{{ org.website }}</a>
							} @else {
								<input class="about-edit-input" type="text" [formControl]="$any(orgForm.get('website'))" placeholder="Weboldal" />
							}
						</span>
					</div>
				}

				<section class="past-events-section">
					<h2 class="past-events-title">Múltbéli események</h2>
					@if (events && events.length > 0) {
						<div class="past-events-list">
							@for(event of events; track event.id) {
								<article class="event-feedback-block">
									<div class="event-card-header">
										<div class="event-card-title">{{ event.title }}</div>
										<div class="event-card-meta">{{ event.date | date:'yyyy.MM.dd. HH:mm' }}</div>
									</div>
							@if(event.feedbacks && event.feedbacks.length > 0) {
								<div class="event-feedback-list">
									<b>Visszajelzések:</b><br>
									@for(feedback of event.feedbacks; track feedback.id) {
										<div class="feedback-item">
											<div class="feedback-left">
												<div class="feedback-text">
													<span class="feedback-comment">{{feedback.comment}}</span>
													@if (feedback.updated_at) {
														<span class="feedback-date">{{ feedback.updated_at | date:'yyyy.MM.dd. HH:mm' }}</span>
													}
												</div>
												<span class="star-rating-static feedback-stars">
													@for(star of getStars(5); track star) {
														<span class="star" [class.filled]="star <= feedback.rating">&#9733;</span>
													}
												</span>
											</div>
											@if (canDeleteFeedback(feedback)) {
												<div class="feedback-right">
													<button type="button" class="action-btn delete" (click)="deleteFeedback(feedback.id)">Törlés</button>
												</div>
											}
										</div>
									}
								</div>
							} @else {
								<span>Nincs visszajelzés.</span><br>
							}
							<form (submit)="addFeedback(event.id, $event)" class="event-feedback-form">
								<input type="text" name="comment" placeholder="Komment" required class="feedback-input">
								<span class="star-rating">
									@for(star of [5,4,3,2,1]; track star) {
										<input type="radio" id="star-{{event.id}}-{{star}}" name="rating" value="{{star}}" required>
										<label for="star-{{event.id}}-{{star}}" class="star">&#9733;</label>
									}
								</span>
								<button type="submit" class="feedback-submit-btn">Visszajelzés küldése</button>
							</form>
							</article>
							}
						</div>
					} @else {
						<p class="past-events-empty">Nincs még múltbeli esemény.</p>
					}
				</section>
			</div>
		</section>
	</div>
}
@if (!loading && !org) {
	<div class="about-org-notfound">
		<p>A szervezet nem található.</p>
	</div>
}
@if (loading) {
	<div class="about-org-loading">
		<p>Betöltés...</p>
	</div>
}
