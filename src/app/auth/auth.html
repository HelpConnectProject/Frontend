<div class="auth-page">
    @if (authService.isLoggedIn$ | async) {
        
        <section class="auth-card">
            @if (errorMessage) {
                <div class="auth-error">{{ errorMessage }}</div>
            }
            @if (successMessage) {
                <div class="auth-success">{{ successMessage }}</div>
            }

            @if (!isEditingProfile) {
                <div class="profile-summary">
                    <div class="profile-row"><span class="profile-label">N√©v</span><span class="profile-value">{{ user?.name || '-' }}</span></div>
                    <div class="profile-row"><span class="profile-label">Email</span><span class="profile-value">{{ user?.email || '-' }}</span></div>
                    <div class="profile-row"><span class="profile-label">V√°ros</span><span class="profile-value">{{ user?.city || '-' }}</span></div>
                    <div class="profile-row"><span class="profile-label">Telefon</span><span class="profile-value">{{ user?.phone || '-' }}</span></div>
                    <div class="profile-row profile-row--multiline"><span class="profile-label">Bemutatkoz√°s</span><span class="profile-value profile-value--multiline">{{ user?.about || '-' }}</span></div>
                </div>

                <button class="auth-button" type="button" (click)="startEditProfile()" [disabled]="loading">
                    Szerkeszt√©s
                </button>
            } @else {
                <h3 class="auth-subtitle">Profil szerkeszt√©se</h3>

                <form class="auth-form" [formGroup]="updateForm" (ngSubmit)="updateProfile()">
                    <div class="form-field">
                        <label for="name">N√©v</label>
                        <input id="name" type="text" formControlName="name" autocomplete="name">
                        @if (updateForm?.get('name')?.touched && updateForm?.get('name')?.invalid) {
                            <div class="field-hint">A n√©v megad√°sa k√∂telez≈ë.</div>
                        }
                    </div>

                    <div class="form-field">
                        <label for="profileEmail">Email</label>
                        <input id="profileEmail" type="email" formControlName="email" autocomplete="email" readonly>
                    </div>

                    <div class="form-field">
                        <label for="city">V√°ros</label>
                        <input id="city" type="text" formControlName="city" autocomplete="address-level2">
                    </div>

                    <div class="form-field">
                        <label for="phone">Telefon</label>
                        <input id="phone" type="text" formControlName="phone" autocomplete="tel">
						@if (updateForm.get('phone')?.touched && (updateForm.get('phone')?.errors?.['phoneInvalidChars'] || updateForm.get('phone')?.errors?.['phoneDigits'])) {
							<div class="field-hint">Hib√°s telefonsz√°m form√°tum</div>
						}
                    </div>

                    <div class="form-field">
                        <label for="about">Bemutatkoz√°s</label>
                        <textarea id="about" rows="4" formControlName="about"></textarea>
                    </div>

                    <div class="profile-actions">
                        <button class="auth-button" type="submit" [disabled]="loading || updateForm?.disabled">
                            @if(!loading){Ment√©s} @else{<span>Ment√©s...</span>}
                        </button>
                        <button class="auth-button auth-button--secondary" type="button" (click)="cancelEditProfile()" [disabled]="loading">
                            M√©gse
                        </button>
                    </div>
                </form>
            }

            <button class="auth-button" (click)="logout()">Kijelentkez√©s</button>
        </section>
    } @else {
        <section class="auth-card">
            @if(!forgotPassword){
                <h2>Bel√©p√©s</h2>
                <p class="auth-description">Jelentkezz be, hogy el√©rd az esem√©nyeket √©s a szervezeteket.</p>
            }@else{
                <h2>Jelsz√≥ vissza√°ll√≠t√°sa</h2>
                <p class="auth-description">Add meg az email c√≠med, √©s k√ºld√ºnk egy linket a jelsz√≥ vissza√°ll√≠t√°s√°hoz.</p>
            }

            @if (errorMessage) {
                <div class="auth-error">{{ errorMessage }}</div>
            }

            <form class="auth-form" [formGroup]="loginForm" (ngSubmit)="forgotPassword ? sendPasswordReset() : login()">
                <div class="form-field">
                    <label for="email">Email</label>
                    <input id="email" type="email" formControlName="email">
                </div>

                @if(!forgotPassword){
                    <div class="form-field">
                        <label for="password">Jelsz√≥</label>
                        <div class="password-input">
                            <input id="password" [type]="showPassword ? 'text' : 'password'" formControlName="password">
                            <button
                                type="button"
                                class="password-toggle"
                                (click)="showPassword = !showPassword"
                                [attr.aria-label]="showPassword ? 'Jelsz√≥ elrejt√©se' : 'Jelsz√≥ megjelen√≠t√©se'"
                            >
                                üëÅ
                            </button>
                        </div>
                    </div>
                }

                @if(forgotPassword){
                    <button class="auth-button" type="submit" [disabled]="loading || loginForm?.disabled">
                        @if(!loading){Visszaigazol√≥ email k√ºld√©se} @else{<span>K√ºld√©s...</span>}
                    </button>
                }@else{
                    <button class="auth-button" type="submit" [disabled]="loading || loginForm?.disabled">
                        @if(!loading){Bel√©p√©s} @else{<span>Bel√©p√©s...</span>}
                    </button>
                }
            </form>

            <p class="auth-link">Nincs m√©g fi√≥kod? <a routerLink="/registration">Regisztr√°lj most</a></p>
            
            @if(!forgotPassword){
                <p class="auth-link">Elfelejtetted a jelszavad?  <a (click)="forgotPasswordChangeTrue()">Jelsz√≥ vissza√°ll√≠t√°sa</a></p>
            }@else{
                <p class="auth-link">Eml√©kszel a jelszavadra?  <a (click)="forgotPasswordChangeFalse()">Bel√©p√©s</a></p>
            }

            
            
        </section>
    }
</div>

