<div class="auth-page">
    @if (authService.isLoggedIn$ | async) {
        
        <section class="auth-card">
            @if (errorMessage) {
                <div class="auth-error">{{ errorMessage }}</div>
            }
            @if (successMessage) {
                <div class="auth-success">{{ successMessage }}</div>
            }

            @if (!isEditingProfile) {
                <div class="profile-summary">
                    <div class="profile-row"><span class="profile-label">Név</span><span class="profile-value">{{ user?.name || '-' }}</span></div>
                    <div class="profile-row"><span class="profile-label">Email</span><span class="profile-value">{{ user?.email || '-' }}</span></div>
                    <div class="profile-row"><span class="profile-label">Város</span><span class="profile-value">{{ user?.city || '-' }}</span></div>
                    <div class="profile-row"><span class="profile-label">Telefon</span><span class="profile-value">{{ user?.phone || '-' }}</span></div>
                    <div class="profile-row profile-row--multiline"><span class="profile-label">Bemutatkozás</span><span class="profile-value profile-value--multiline">{{ user?.about || '-' }}</span></div>
                </div>

                <button class="auth-button" type="button" (click)="startEditProfile()" [disabled]="loading">
                    Szerkesztés
                </button>
            } @else {
                <h3 class="auth-subtitle">Profil szerkesztése</h3>

                <form class="auth-form" [formGroup]="updateForm" (ngSubmit)="updateProfile()">
                    <div class="form-field">
                        <label for="name">Név</label>
                        <input id="name" type="text" formControlName="name" autocomplete="name">
                        @if (updateForm?.get('name')?.touched && updateForm?.get('name')?.invalid) {
                            <div class="field-hint">A név megadása kötelező.</div>
                        }
                    </div>

                    <div class="form-field">
                        <label for="profileEmail">Email</label>
                        <input id="profileEmail" type="email" formControlName="email" autocomplete="email" readonly>
                    </div>

                    <div class="form-field">
                        <label for="city">Város</label>
                        <input id="city" type="text" formControlName="city" autocomplete="address-level2">
                    </div>

                    <div class="form-field">
                        <label for="phone">Telefon</label>
                        <input id="phone" type="text" formControlName="phone" autocomplete="tel">
                    </div>

                    <div class="form-field">
                        <label for="about">Bemutatkozás</label>
                        <textarea id="about" rows="4" formControlName="about"></textarea>
                    </div>

                    <div class="profile-actions">
                        <button class="auth-button" type="submit" [disabled]="loading || updateForm?.disabled">
                            @if(!loading){Mentés} @else{<span>Mentés...</span>}
                        </button>
                        <button class="auth-button auth-button--secondary" type="button" (click)="cancelEditProfile()" [disabled]="loading">
                            Mégse
                        </button>
                    </div>
                </form>
            }

            <button class="auth-button" (click)="logout()">Kijelentkezés</button>
        </section>
    } @else {
        <section class="auth-card">
            @if(!forgotPassword){
                <h2>Belépés</h2>
                <p class="auth-description">Jelentkezz be, hogy elérd az eseményeket és a szervezeteket.</p>
            }@else{
                <h2>Jelszó visszaállítása</h2>
                <p class="auth-description">Add meg az email címed, és küldünk egy linket a jelszó visszaállításához.</p>
            }

            @if (errorMessage) {
                <div class="auth-error">{{ errorMessage }}</div>
            }

            <form class="auth-form" [formGroup]="loginForm" (ngSubmit)="forgotPassword ? sendPasswordReset() : login()">
                <div class="form-field">
                    <label for="email">Email</label>
                    <input id="email" type="email" formControlName="email">
                </div>

                @if(!forgotPassword){
                    <div class="form-field">
                        <label for="password">Jelszó</label>
                        <input id="password" type="password" formControlName="password">
                    </div>
                }

                @if(forgotPassword){
                    <button class="auth-button" type="submit" [disabled]="loading || loginForm?.disabled">
                        @if(!loading){Visszaigazoló email küldése} @else{<span>Küldés...</span>}
                    </button>
                }@else{
                    <button class="auth-button" type="submit" [disabled]="loading || loginForm?.disabled">
                        @if(!loading){Belépés} @else{<span>Belépés...</span>}
                    </button>
                }
            </form>

            <p class="auth-link">Nincs még fiókod? <a routerLink="/registration">Regisztrálj most</a></p>
            
            @if(!forgotPassword){
                <p class="auth-link">Elfelejtetted a jelszavad?  <a (click)="forgotPasswordChangeTrue()">Jelszó visszaállítása</a></p>
            }@else{
                <p class="auth-link">Emlékszel a jelszavadra?  <a (click)="forgotPasswordChangeFalse()">Belépés</a></p>
            }

            
            
        </section>
    }
</div>

